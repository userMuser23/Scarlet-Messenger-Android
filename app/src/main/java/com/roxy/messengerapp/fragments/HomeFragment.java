package com.roxy.messengerapp.fragments;import android.content.Intent;import android.os.Bundle;import android.view.LayoutInflater;import android.view.Menu;import android.view.MenuInflater;import android.view.MenuItem;import android.view.View;import android.view.ViewGroup;import android.widget.TextView;import androidx.annotation.NonNull;import androidx.annotation.Nullable;import androidx.appcompat.app.AppCompatActivity;import androidx.appcompat.widget.Toolbar;import androidx.fragment.app.Fragment;import androidx.viewpager2.widget.ViewPager2;import com.bumptech.glide.Glide;import com.google.android.material.tabs.TabLayout;import com.google.android.material.tabs.TabLayoutMediator;import com.google.firebase.auth.FirebaseAuth;import com.google.firebase.auth.FirebaseUser;import com.google.firebase.database.DataSnapshot;import com.google.firebase.database.DatabaseError;import com.google.firebase.database.DatabaseReference;import com.google.firebase.database.FirebaseDatabase;import com.google.firebase.database.ValueEventListener;import com.roxy.messengerapp.R;import com.roxy.messengerapp.activities.StartActivity;import com.roxy.messengerapp.adapters.ViewPagerAdapter;import com.roxy.messengerapp.entities.User;import de.hdodenhof.circleimageview.CircleImageView;public class HomeFragment extends Fragment {    CircleImageView profile_image;    TextView username;    FirebaseUser firebaseUser;    DatabaseReference reference;    @Override    public View onCreateView(LayoutInflater inflater, ViewGroup container,                             Bundle savedInstanceState) {        // Чтобы меню (3 точки) работало во фрагменте        setHasOptionsMenu(true);        return inflater.inflate(R.layout.fragment_home, container, false);    }    @Override    public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {        super.onViewCreated(view, savedInstanceState);        // 1. Находим Toolbar и делаем его главным        Toolbar toolbar = view.findViewById(R.id.toolbar);        if(getActivity() != null) {            ((AppCompatActivity) getActivity()).setSupportActionBar(toolbar);            ((AppCompatActivity) getActivity()).getSupportActionBar().setTitle("");        }        profile_image = view.findViewById(R.id.profile_image);        username = view.findViewById(R.id.username);        TabLayout tabLayout = view.findViewById(R.id.tab_layout);        ViewPager2 viewPager = view.findViewById(R.id.view_pager);        // 2. Загружаем данные пользователя (Код переехал из MainActivity)        firebaseUser = FirebaseAuth.getInstance().getCurrentUser();        reference = FirebaseDatabase.getInstance().getReference("Users").child(firebaseUser.getUid());        reference.addValueEventListener(new ValueEventListener() {            @Override            public void onDataChange(@NonNull DataSnapshot snapshot) {                User user = snapshot.getValue(User.class);                if (user != null) {                    username.setText(user.getUsername());                    if (user.getImageURL().equals("default")){                        profile_image.setImageResource(R.mipmap.ic_launcher);                    } else {                        if (getContext() != null)                            Glide.with(getContext()).load(user.getImageURL()).into(profile_image);                    }                }            }            @Override            public void onCancelled(@NonNull DatabaseError error) {}        });        // 3. Настраиваем Вкладки        ViewPagerAdapter viewPagerAdapter = new ViewPagerAdapter(this);        viewPagerAdapter.addFragment(new ChatsFragment(), "Чаты");        viewPagerAdapter.addFragment(new UsersFragment(), "Пользователи");        viewPager.setAdapter(viewPagerAdapter);        // Связываем Табы и Пейджер        new TabLayoutMediator(tabLayout, viewPager, (tab, position) -> {            tab.setText(viewPagerAdapter.getTitle(position));        }).attach();    }    // Меню Выхода    @Override    public void onCreateOptionsMenu(@NonNull Menu menu, @NonNull MenuInflater inflater) {        inflater.inflate(R.menu.menu, menu);        super.onCreateOptionsMenu(menu, inflater);    }    @Override    public boolean onOptionsItemSelected(@NonNull MenuItem item) {        if (item.getItemId() == R.id.logout){            FirebaseAuth.getInstance().signOut();            startActivity(new Intent(getActivity(), StartActivity.class).setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP));            return true;        }        return false;    }}